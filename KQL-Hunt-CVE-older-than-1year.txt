// Hunt devices vulnerable to CVE's older than 1 year, uncomment last part to only show CVE's affected by more than 1 device

DeviceTvmSoftwareVulnerabilities
| where CveId contains "CVE-" 
| project DeviceId, DeviceName, OSPlatform, OSVersion, SoftwareVersion, CveId, RecommendedSecurityUpdate, RecommendedSecurityUpdateId
| summarize count(), make_set(DeviceName) by CveId, RecommendedSecurityUpdateId
| join kind = inner DeviceTvmSoftwareVulnerabilitiesKB on CveId 
| where PublishedDate <= ago(365d) // and count_ > 1